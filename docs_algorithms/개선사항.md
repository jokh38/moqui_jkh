## moqui vs. moqui_jkh: 분석 및 향후 개발 방향 제안

`moqui`와 이를 수정한 `moqui_jkh` 프로그램의 주요 차이점을 분석하고, `moqui_jkh`의 향후 개발 방향을 제안합니다. 📝

---

### 주요 수정 내용

`moqui_jkh`는 원본 `moqui`의 핵심 기능을 유지하면서 **사용자 편의성, 문서화, 그리고 특정 치료 장비에 대한 지원을 강화**하는 방향으로 수정되었습니다. 주요 변경 사항은 다음과 같습니다.

| 구분 | moqui | moqui_jkh | 변경 내용 |
| --- | --- | --- | --- |
| **README** | 기본적인 설치 및 실행 방법 위주로 기술 | 프로젝트 목적, 기능, 빌드 방법, 사용법, 파라미터 등 상세 정보 추가 | 문서화를 통해 사용자가 프로그램을 더 쉽게 이해하고 사용할 수 있도록 개선 |
| **빌드 시스템 (CMake)** | CUDA 7.5를 기본으로 사용하며, 사용자가 직접 수정 필요 | CUDA 11.7을 기본으로 설정하고, GPU 사용 여부를 `GPU` 변수로 제어 | 특정 버전의 CUDA Toolkit에 맞춰 빌드 환경을 고정하고, CPU/GPU 빌드 전환을 용이하게 변경 |
| **코드 문서화** | 코드 내 주석 부족 | Doxygen을 활용한 상세한 주석 추가 | 코드 가독성 및 유지보수 편의성 향상 |
| **치료 장비 모델** | 일반적인 양성자 치료 시스템 모델 제공 | 삼성서울병원(SMC)의 GTR1, GTR2 장비 모델 추가 | `spline_interp.hpp`를 이용해 특정 장비의 빔 특성을 정밀하게 모델링 |
| **물질 정보** | 표준 물질 정보 사용 | `mqi_material_ct.hpp` 파일 추가 (기능적으로는 `mqi_material.hpp`와 동일) | CT 영상 기반의 물질 정보 활용 가능성을 염두에 둔 구조 변경 (현재는 기능적 차이 없음) |
| **Phase Space** | 다양한 Phase Space 분포 모델 제공 | `mqi_phsp6d_ray.hpp` 파일에 소스 위치(`source_position`) 변수 추가 | Ray-tracing 시뮬레이션의 정확도 향상을 위한 기능 추가 |

---

### 수정 현황

`moqui_jkh`의 수정 작업은 **대부분 완료되었지만, 일부 기능은 추가 개발이 필요**한 상태입니다.

* **완료된 항목**
    * **문서화:** README 파일과 Doxygen 주석을 통해 프로그램 전반에 대한 상세한 설명이 추가되었습니다.
    * **빌드 시스템 개선:** CMake 스크립트 수정을 통해 특정 CUDA 버전에 대한 빌드 환경이 구성되었고, GPU 사용 여부를 쉽게 선택할 수 있습니다.
    * **SMC 치료 장비 모델 추가:** GTR1, GTR2 모델이 추가되어 해당 장비를 사용하는 환경에서 보다 정확한 시뮬레이션이 가능해졌습니다.

* **진행 중인 항목**
    * **테스트:** `README.md` 파일에 "A formal testing suite has not yet been established for this project"라고 명시된 바와 같이, 아직 공식적인 테스트 절차가 마련되지 않았습니다.
    * **CT 기반 물질 정보:** `mqi_material_ct.hpp` 파일이 추가되었지만, 실제 CT 데이터를 이용해 물질 정보를 생성하고 시뮬레이션에 적용하는 기능은 아직 구현되지 않았습니다.

---

### 향후 개발 방향 제안

`moqui_jkh`를 더욱 발전시키기 위해 다음과 같은 기능 추가 및 개선을 제안합니다.

1.  **테스트 자동화 환경 구축**
    * **단위 테스트 (Unit Test):** 주요 함수 및 클래스에 대한 단위 테스트를 추가하여 코드의 안정성을 확보하고, 향후 기능 변경 시 발생할 수 있는 문제를 사전에 방지해야 합니다.
    * **통합 테스트 (Integration Test):** 실제 DICOM 데이터를 이용한 통합 테스트 케이스를 개발하여, 전체 시스템이 의도한 대로 동작하는지 검증하는 절차가 필요합니다.

2.  **CT 기반 물질 정보 처리 기능 완성**
    * **CT 데이터 파싱:** DICOM-CT 영상에서 Hounsfield Unit (HU) 값을 읽어와 밀도 및 물질 정보로 변환하는 기능을 구현해야 합니다.
    * **물질 정보 적용:** 변환된 물질 정보를 시뮬레이션 환경에 적용하여, 환자 개별 맞춤형 시뮬레이션의 정확도를 높일 수 있습니다.

3.  **사용자 인터페이스(UI) 개선**
    * **입력 파일 유효성 검사:** 시뮬레이션 파라미터 입력 파일의 형식을 검사하고, 오류가 있을 경우 사용자에게 친절한 메시지를 보여주는 기능을 추가하면 사용 편의성이 크게 향상될 것입니다.
    * **결과 시각화:** 선량 분포, LET 등 시뮬레이션 결과를 2D 또는 3D 그래픽으로 시각화하는 기능을 추가하여 결과 분석을 용이하게 만들 수 있습니다.

4.  **최신 기술 스택 적용**
    * **최신 CUDA 버전 지원:** 현재 고정된 CUDA 11.7 외에 최신 CUDA 버전을 지원하도록 CMake 스크립트를 개선하여 최신 GPU 아키텍처의 성능을 활용할 수 있도록 합니다.
    * **코드 리팩토링:** `mqi_material_ct.hpp`와 같이 중복되는 코드를 제거하고, 전반적인 코드 구조를 개선하여 유지보수성을 높이는 작업을 진행하는 것이 좋습니다.

`moqui_jkh`는 `moqui`를 기반으로 특정 사용 환경에 맞춰 성공적으로 개선된 프로그램입니다. 제안된 내용들을 바탕으로 기능을 확장하고 안정성을 높인다면, 더욱 강력하고 유연한 방사선 치료 시뮬레이션 툴킷으로 발전할 수 있을 것입니다. 🚀